// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.

import { APIResource } from '../../core/resource';
import { APIPromise } from '../../core/api-promise';
import { RequestOptions } from '../../internal/request-options';

export class Task extends APIResource {
  /**
   * Launch a new agent task powered by our distributed browser network.
   *
   * @example
   * ```ts
   * const task = await client.agent.task.create({
   *   agent: 'gemini',
   *   mode: 'text',
   *   prompt: 'Go to example.com and summarize the content.',
   * });
   * ```
   */
  create(body: TaskCreateParams, options?: RequestOptions): APIPromise<TaskCreateResponse> {
    return this._client.post('/v1/agent/task', { body, ...options });
  }

  /**
   * List agent tasks.
   *
   * @example
   * ```ts
   * const tasks = await client.agent.task.list();
   * ```
   */
  list(
    query: TaskListParams | null | undefined = {},
    options?: RequestOptions,
  ): APIPromise<TaskListResponse> {
    return this._client.get('/v1/agent/tasks', { query, ...options });
  }

  /**
   * Retrieve the status and result of an existing agent task.
   *
   * @example
   * ```ts
   * const task = await client.agent.task.get({
   *   taskId: '4631208b-8dcf-4dde-8d05-ef629e2825f4',
   * });
   * ```
   */
  get(query: TaskGetParams, options?: RequestOptions): APIPromise<TaskGetResponse> {
    return this._client.get('/v1/agent/task', { query, ...options });
  }
}

export interface TaskCreateResponse {
  /**
   * The unique identifier for the created agent task.
   */
  taskId: string;
}

export interface TaskListResponse {
  /**
   * Current page number
   */
  page: number;

  /**
   * Number of items per page
   */
  pageSize: number;

  /**
   * List of tasks.
   */
  tasks: Array<TaskListResponse.Task>;

  /**
   * Total number of items
   */
  total: number;

  /**
   * Total number of pages
   */
  totalPages: number;
}

export namespace TaskListResponse {
  export interface Task {
    /**
     * The consumer ID.
     */
    consumerId: string;

    /**
     * Timestamp when the task was created.
     */
    createdAt: string;

    /**
     * The node identifier.
     */
    node: string;

    /**
     * The details of the agent run.
     */
    run: Task.UnionMember0 | Task.Error;

    /**
     * The status of the task.
     */
    status: string;

    /**
     * The unique identifier for the agent task.
     */
    taskId: string;
  }

  export namespace Task {
    export interface UnionMember0 {
      /**
       * The unique identifier for the agent task.
       */
      id: string;

      /**
       * Number of attempts made to complete the task.
       */
      attemptsMade: number;

      /**
       * The input data for the agent task.
       */
      data: UnionMember0.Data;

      /**
       * Total input tokens used (null if task is still active).
       */
      inputTokens: number | null;

      /**
       * Total output tokens used (null if task is still active).
       */
      outputTokens: number | null;

      /**
       * The result of the task (null if still active or failed).
       */
      result: UnionMember0.Result | null;

      /**
       * Timestamp when the task was started (milliseconds since epoch).
       */
      startedAt: number;

      /**
       * The current state of the agent task.
       */
      state: 'active' | 'completed' | 'failed';

      /**
       * Timestamp when the task was stopped (null if still running).
       */
      stoppedAt: number | null;

      /**
       * The type of task.
       */
      task: string;
    }

    export namespace UnionMember0 {
      /**
       * The input data for the agent task.
       */
      export interface Data {
        /**
         * The agent model/framework used.
         */
        agent: 'gemini' | 'glitter';

        /**
         * The output mode of the agent.
         */
        mode: 'text';

        /**
         * The prompt sent to the agent.
         */
        prompt: string;

        /**
         * The maximum number of steps the agent can take.
         */
        stepLimit: number;
      }

      /**
       * The result of the task (null if still active or failed).
       */
      export interface Result {
        /**
         * The final answer or result from the agent.
         */
        answer: string;

        /**
         * Maximum allowed steps.
         */
        stepLimit: number;

        /**
         * Number of steps taken by the agent.
         */
        steps: number;

        /**
         * Token usage summary.
         */
        tokenUsage: Result.TokenUsage;

        /**
         * Token usage breakdown by agent.
         */
        tokenUsageByAgent: { [key: string]: Result.TokenUsageByAgent };
      }

      export namespace Result {
        /**
         * Token usage summary.
         */
        export interface TokenUsage {
          /**
           * Total input tokens used.
           */
          inputTokens: number;

          /**
           * Total output tokens used.
           */
          outputTokens: number;
        }

        export interface TokenUsageByAgent {
          inputTokens: number;

          outputTokens: number;
        }
      }
    }

    export interface Error {
      /**
       * Error message if the run details could not be fetched.
       */
      error: string;
    }
  }
}

export interface TaskGetResponse {
  /**
   * The unique identifier for the agent task.
   */
  id: string;

  /**
   * Number of attempts made to complete the task.
   */
  attemptsMade: number;

  /**
   * The input data for the agent task.
   */
  data: TaskGetResponse.Data;

  /**
   * Total input tokens used (null if task is still active).
   */
  inputTokens: number | null;

  /**
   * Total output tokens used (null if task is still active).
   */
  outputTokens: number | null;

  /**
   * The result of the task (null if still active or failed).
   */
  result: TaskGetResponse.Result | null;

  /**
   * Timestamp when the task was started (milliseconds since epoch).
   */
  startedAt: number;

  /**
   * The current state of the agent task.
   */
  state: 'active' | 'completed' | 'failed';

  /**
   * Timestamp when the task was stopped (null if still running).
   */
  stoppedAt: number | null;

  /**
   * The type of task.
   */
  task: string;
}

export namespace TaskGetResponse {
  /**
   * The input data for the agent task.
   */
  export interface Data {
    /**
     * The agent model/framework used.
     */
    agent: 'gemini' | 'glitter';

    /**
     * The output mode of the agent.
     */
    mode: 'text';

    /**
     * The prompt sent to the agent.
     */
    prompt: string;

    /**
     * The maximum number of steps the agent can take.
     */
    stepLimit: number;
  }

  /**
   * The result of the task (null if still active or failed).
   */
  export interface Result {
    /**
     * The final answer or result from the agent.
     */
    answer: string;

    /**
     * Maximum allowed steps.
     */
    stepLimit: number;

    /**
     * Number of steps taken by the agent.
     */
    steps: number;

    /**
     * Token usage summary.
     */
    tokenUsage: Result.TokenUsage;

    /**
     * Token usage breakdown by agent.
     */
    tokenUsageByAgent: { [key: string]: Result.TokenUsageByAgent };
  }

  export namespace Result {
    /**
     * Token usage summary.
     */
    export interface TokenUsage {
      /**
       * Total input tokens used.
       */
      inputTokens: number;

      /**
       * Total output tokens used.
       */
      outputTokens: number;
    }

    export interface TokenUsageByAgent {
      inputTokens: number;

      outputTokens: number;
    }
  }
}

export interface TaskCreateParams {
  /**
   * The agent model/framework to use.
   */
  agent: 'gemini' | 'glitter';

  /**
   * The output mode of the agent.
   */
  mode: 'text';

  /**
   * Your prompt to the agent.
   */
  prompt: string;

  /**
   * The maximum number of steps the agent can take.
   */
  stepLimit?: number;
}

export interface TaskListParams {
  /**
   * Page number
   */
  page?: number;

  /**
   * Number of items per page
   */
  pageSize?: number;
}

export interface TaskGetParams {
  /**
   * The unique identifier for the agent task.
   */
  taskId: string;
}

export declare namespace Task {
  export {
    type TaskCreateResponse as TaskCreateResponse,
    type TaskListResponse as TaskListResponse,
    type TaskGetResponse as TaskGetResponse,
    type TaskCreateParams as TaskCreateParams,
    type TaskListParams as TaskListParams,
    type TaskGetParams as TaskGetParams,
  };
}
